{{ define "main" }}

{{ partial "inner-header.html" . }}

<section class="section-padding bg-cream">
  <div class="container">

    {{/* Split into upcoming, recent (â‰¤3 months), and archive (>3 months) */}}
    {{ $now := now }}
    {{ $threeMonthsAgo := $now.AddDate 0 -3 0 }}
    {{ $upcoming := slice }}
    {{ $recent := slice }}
    {{ $archive := slice }}
    {{ range .Pages }}
      {{ $evDate := .Date }}
      {{ with .Params.event_date }}{{ $evDate = time . }}{{ end }}
      {{ if $evDate.After $now }}
        {{ $upcoming = $upcoming | append . }}
      {{ else if $evDate.After $threeMonthsAgo }}
        {{ $recent = $recent | append . }}
      {{ else }}
        {{ $archive = $archive | append . }}
      {{ end }}
    {{ end }}
    {{ $recent = sort $recent "Date" "desc" }}
    {{ $archive = sort $archive "Date" "desc" }}

    <!-- Upcoming Events -->
    {{ if $upcoming }}
    <div class="mb-5">
      <span class="section-tag">Upcoming</span>
      <h2 class="section-heading mb-4">Upcoming Events</h2>
      <div class="row g-4">
        {{ range $upcoming }}
        {{ $event := . }}
        {{ $evDate := $event.Date }}{{ with $event.Params.event_date }}{{ $evDate = time . }}{{ end }}
        <div class="col-md-4 fade-up">
          <article class="event-card">
            {{ with $event.Params.image }}
            <a href="{{ $event.RelPermalink }}" class="event-card-img">
              {{ partial "img.html" (dict "src" (strings.TrimPrefix "/" .) "alt" $event.Title "width" 500) }}
              <div class="event-card-date">
                <span class="day">{{ $evDate.Format "02" }}</span>
                <span class="month">{{ $evDate.Format "Jan" }}</span>
                <span class="year">{{ $evDate.Format "2006" }}</span>
              </div>
            </a>
            {{ end }}
            <div class="event-card-body">
              <h5><a href="{{ $event.RelPermalink }}">{{ $event.Title }}</a></h5>
              <p>{{ $event.Summary | plainify | htmlUnescape | truncate 120 }}</p>
              <a href="{{ $event.RelPermalink }}" class="read-more">Details <i class="bi bi-arrow-right"></i></a>
            </div>
          </article>
        </div>
        {{ end }}
      </div>
    </div>
    {{ end }}

    <!-- Recent Events (last 3 months) -->
    {{ if $recent }}
    <div class="mb-5">
      <span class="section-tag">Recent</span>
      <h2 class="section-heading mb-4">Recent Events</h2>
      <div class="row g-4">
        {{ range $recent }}
        {{ $event := . }}
        <div class="col-md-4 fade-up">
          <article class="event-card">
            {{ with $event.Params.image }}
            <a href="{{ $event.RelPermalink }}" class="event-card-img">
              {{ partial "img.html" (dict "src" (strings.TrimPrefix "/" .) "alt" $event.Title "width" 500) }}
              <div class="event-card-date">
                <span class="day">{{ $event.Date.Format "02" }}</span>
                <span class="month">{{ $event.Date.Format "Jan" }}</span>
                <span class="year">{{ $event.Date.Format "2006" }}</span>
              </div>
            </a>
            {{ end }}
            <div class="event-card-body">
              <h5><a href="{{ $event.RelPermalink }}">{{ $event.Title }}</a></h5>
              <p>{{ $event.Summary | plainify | htmlUnescape | truncate 120 }}</p>
              <a href="{{ $event.RelPermalink }}" class="read-more">Read More <i class="bi bi-arrow-right"></i></a>
            </div>
          </article>
        </div>
        {{ end }}
      </div>
    </div>
    {{ end }}

    <!-- Past Events (older than 3 months) -->
    {{ if $archive }}
    <div class="mt-5">
      <span class="section-tag">Archive</span>
      <h2 class="section-heading mb-4">Past Events</h2>
      <div class="row g-4">
        {{ range $archive }}
        <div class="col-md-6 fade-up">
          <article class="event-list-item">
            <div class="row g-0 align-items-center">
              {{ with .Params.image }}
              <div class="col-4">
                <a href="{{ $.RelPermalink }}" class="event-list-img">
                  {{ partial "img.html" (dict "src" (strings.TrimPrefix "/" .) "alt" $.Title "width" 300) }}
                </a>
              </div>
              {{ end }}
              <div class="{{ if .Params.image }}col-8{{ else }}col-12{{ end }}">
                <div class="event-list-body">
                  <div class="event-list-date">
                    <i class="bi bi-calendar3 me-1"></i> {{ .Date.Format "02 Jan 2006" }}
                  </div>
                  <h6><a href="{{ .RelPermalink }}">{{ .Title }}</a></h6>
                  <a href="{{ .RelPermalink }}" class="read-more small">Details <i class="bi bi-arrow-right"></i></a>
                </div>
              </div>
            </div>
          </article>
        </div>
        {{ end }}
      </div>
    </div>
    {{ end }}

  </div>
</section>
{{ end }}
